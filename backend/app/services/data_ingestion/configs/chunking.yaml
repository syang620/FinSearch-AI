# ============================================================================
# Chunking Configuration for FinSearch AI
# ============================================================================
# This configuration controls how parsed JSONL documents are chunked for
# RAG embedding and retrieval. Different strategies are used for EDGAR
# filings vs earnings transcripts.

# ============================================================================
# GLOBAL SETTINGS
# ============================================================================

# Tokenizer to use for counting tokens (must match your LLM)
# Options: cl100k_base (GPT-4, GPT-3.5-turbo), p50k_base (older models)
tokenizer: cl100k_base

# Target chunk size in tokens
# Chunks will aim for this size, but may be smaller or larger based on
# document structure (sections, speakers, Q&A exchanges)
target_chunk_tokens: 600

# Minimum chunk size in tokens
# Chunks smaller than this will be merged with adjacent chunks
min_chunk_tokens: 200

# Maximum chunk size in tokens
# Chunks exceeding this will be split with overlap
max_chunk_tokens: 800

# Overlap ratio for windowed chunks
# When a section exceeds max_chunk_tokens, it's split with this % overlap
# Example: 0.15 = 15% overlap (90 tokens for 600-token chunks)
overlap_ratio: 0.15

# ============================================================================
# EDGAR FILING CONFIGURATION (10-K, 10-Q)
# ============================================================================
filing:
  # Regex pattern to detect section headers
  # Matches: "Item 1. Business", "Item 1A. Risk Factors", etc.
  # (?mi) = multiline + case-insensitive
  # Groups: (1) = Item number (e.g., "1A"), (2) = Section title
  section_regex: '(?mi)^\s*Item\s+(\d+[A]?)\.\s+(.+?)\s*$'

  # Human-readable aliases for common sections
  # Used for display and filtering in RAG retrieval
  section_alias:
    '1': 'Business'
    '1A': 'Risk Factors'
    '1B': 'Unresolved Staff Comments'
    '2': 'Properties'
    '3': 'Legal Proceedings'
    '4': 'Mine Safety Disclosures'
    '5': 'Market for Registrant Common Equity'
    '6': 'Reserved'
    '7': 'MD&A'
    '7A': 'Market Risk'
    '8': 'Financial Statements'
    '9': 'Changes in Accounting'
    '9A': 'Controls and Procedures'
    '9B': 'Other Information'
    '10': 'Directors and Executive Officers'
    '11': 'Executive Compensation'
    '12': 'Security Ownership'
    '13': 'Related Transactions'
    '14': 'Principal Accountant Fees'
    '15': 'Exhibits'

  # Chunking strategy notes:
  # 1. Group paragraphs by section_id (already in metadata)
  # 2. Within each section, pack paragraphs to target_chunk_tokens
  # 3. If packed chunk > max_chunk_tokens, split with overlap_ratio
  # 4. Never overlap across section boundaries

# ============================================================================
# EARNINGS TRANSCRIPT CONFIGURATION
# ============================================================================
transcript:
  # Patterns to detect phase transitions
  # Phase 1: Prepared Remarks (executive presentations)
  # Phase 2: Q&A (analyst questions + executive answers)
  phase_headers:
    - '(?i)prepared remarks'
    - '(?i)prepared\s+remarks'
    - '(?i)question\s*&\s*answer'
    - '(?i)question.and.answer'
    - '(?i)Q\s*&\s*A'
    - '(?i)questions?\s+and\s+answers?'

  # Patterns to identify question vs answer speakers
  # Used to pair Q&A exchanges (Question + Answer as single chunk)
  qa_patterns:
    # Analyst question indicators
    question_speaker_regex: '(?i)^(analyst|q:|question\:)'

    # Executive answer indicators
    answer_speaker_regex: '(?i)^(ceo|cfo|coo|cto|a:|answer\:)'

  # Chunking strategy notes:
  # Prepared Remarks:
  #   - Pack utterances to target_chunk_tokens (~600)
  #   - Don't split across speakers unnecessarily
  #
  # Q&A Section:
  #   - Combine (Analyst Question + Executive Answer) as single exchange
  #   - If exchange <= max_chunk_tokens (800): keep together
  #   - If exchange > max_chunk_tokens: split answer with overlap_ratio
  #   - Always preserve speaker_name, speaker_role, exchange_id in metadata
